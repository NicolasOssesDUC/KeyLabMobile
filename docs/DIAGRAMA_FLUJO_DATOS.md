# ๐ Diagrama de Flujo de Datos - KeyLab Mobile

## ๐ Arquitectura MVVM Completa

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                          USUARIO (Pantalla)                         โ
โ  ๐ค Ve productos, hace click, agrega al carrito, compra, etc.      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         CAPA UI (Vista)                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ                                                                     โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ             โ
โ  โLoginActivity โ  โ MainActivity โ  โCategoryActivity            โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ             โ
โ                                                                     โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ             โ
โ  โ CartActivity โ  โProfileActivityโ โProductDetailโ              โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ             โ
โ                                                                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                โ
โ  โ         RecyclerView Adapters                  โ                โ
โ  โ  โข ProductoAdapter  โข CartAdapter              โ                โ
โ  โ  โข CategoryAdapter                             โ                โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                โ
โ                                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโคโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ observa LiveData/Flow
                                 โ llama funciones
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    CAPA VIEWMODEL (Lรณgica)                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ                                                                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ           ProductoViewModel                                โ    โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ    โ
โ  โ  โ Expone:                                              โ โ    โ
โ  โ  โ  โข productos: Flow<List<Producto>>                   โ โ    โ
โ  โ  โ  โข isLoading: LiveData<Boolean>                      โ โ    โ
โ  โ  โ  โข error: LiveData<String?>                          โ โ    โ
โ  โ  โ                                                       โ โ    โ
โ  โ  โ Funciones:                                           โ โ    โ
โ  โ  โ  โข sincronizarProductos()                            โ โ    โ
โ  โ  โ  โข buscarProductos(query)                            โ โ    โ
โ  โ  โ  โข filtrarPorCategoria(cat)                          โ โ    โ
โ  โ  โ  โข crearProducto()                                   โ โ    โ
โ  โ  โ  โข eliminarProducto()                                โ โ    โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ                                                                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ           CarritoViewModel                                 โ    โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ    โ
โ  โ  โ Expone:                                              โ โ    โ
โ  โ  โ  โข items: Flow<List<CarritoItem>>                    โ โ    โ
โ  โ  โ  โข totalItems: Flow<Int>                             โ โ    โ
โ  โ  โ  โข subtotal: Flow<Double>                            โ โ    โ
โ  โ  โ  โข total: Flow<Double>                               โ โ    โ
โ  โ  โ                                                       โ โ    โ
โ  โ  โ Funciones:                                           โ โ    โ
โ  โ  โ  โข agregarProducto(producto)                         โ โ    โ
โ  โ  โ  โข incrementarCantidad(id)                           โ โ    โ
โ  โ  โ  โข eliminarItem(id)                                  โ โ    โ
โ  โ  โ  โข vaciarCarrito()                                   โ โ    โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ                                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโคโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ llama Repository
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  CAPA REPOSITORY (Coordinaciรณn)                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ                                                                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ         ProductoRepository (Offline-First)                 โ    โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ    โ
โ  โ  โ  1. Devuelve Flow de Room (datos locales)            โ โ    โ
โ  โ  โ     โ UI se actualiza RรPIDO                          โ โ    โ
โ  โ  โ                                                       โ โ    โ
โ  โ  โ  2. Sincroniza con API en background                 โ โ    โ
โ  โ  โ     โ Trae nuevos datos de Supabase                  โ โ    โ
โ  โ  โ                                                       โ โ    โ
โ  โ  โ  3. Guarda en Room                                   โ โ    โ
โ  โ  โ     โ Flow emite cambios automรกticamente             โ โ    โ
โ  โ  โ                                                       โ โ    โ
โ  โ  โ  4. UI se actualiza sola (reactivo)                  โ โ    โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ                                                                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ         CarritoRepository (Solo Local)                     โ    โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ    โ
โ  โ  โ  โข Gestiona carrito en Room SQLite                   โ โ    โ
โ  โ  โ  โข No usa API (persistencia local)                   โ โ    โ
โ  โ  โ  โข Calcula subtotales y envรญo                        โ โ    โ
โ  โ  โ  โข Persiste incluso al cerrar app                    โ โ    โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ                                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโคโโโโโโโโโโโโโโโโโโโโคโโโโโโโโโโโโโโโโโโโโโโโโโโ
                        โ                   โ
         โโโโโโโโโโโโโโโโ                   โโโโโโโโโโโโโโโโ
         โ                                                  โ
         โ                                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโ              โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   CAPA DATA (Local)   โ              โ   CAPA DATA (Remota)          โ
โโโโโโโโโโโโโโโโโโโโโโโโโฃ              โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ                       โ              โ                               โ
โ  โโโโโโโโโโโโโโโโโโโ  โ              โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  AppDatabase    โ  โ              โ  โ  RetrofitClient         โ  โ
โ  โ   (Room v3)     โ  โ              โ  โ  โข Auth interceptor     โ  โ
โ  โ                 โ  โ              โ  โ  โข Logging             โ  โ
โ  โ  Versiรณn: 3     โ  โ              โ  โ  โข Timeouts 30s        โ  โ
โ  โโโโโโโโโโโโโโโโโโโ  โ              โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ          โ            โ              โ              โ                โ
โ          โ            โ              โ              โ                โ
โ  โโโโโโโโโโโโโโโโโโโ  โ              โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  ProductoDao    โ  โ              โ  โ  SupabaseApiService     โ  โ
โ  โ  17 funciones   โ  โ              โ  โ                         โ  โ
โ  โ  โข SELECT       โ  โ              โ  โ  GET    /productos      โ  โ
โ  โ  โข INSERT       โ  โ              โ  โ  GET    /productos/:id  โ  โ
โ  โ  โข UPDATE       โ  โ              โ  โ  POST   /productos      โ  โ
โ  โ  โข DELETE       โ  โ              โ  โ  PATCH  /productos/:id  โ  โ
โ  โโโโโโโโโโโโโโโโโโโ  โ              โ  โ  DELETE /productos/:id  โ  โ
โ                       โ              โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โโโโโโโโโโโโโโโโโโโ  โ              โ                               โ
โ  โ  CarritoDao     โ  โ              โ  Headers automรกticos:         โ
โ  โ  9 funciones    โ  โ              โ  โข apikey: SUPABASE_KEY       โ
โ  โ  โข SELECT       โ  โ              โ  โข Authorization: Bearer ...  โ
โ  โ  โข INSERT       โ  โ              โ                               โ
โ  โ  โข UPDATE       โ  โ              โ                               โ
โ  โ  โข DELETE       โ  โ              โ                               โ
โ  โโโโโโโโโโโโโโโโโโโ  โ              โ                               โ
โ          โ            โ              โ              โ                โ
โ          โ            โ              โ              โ                โ
โ  โโโโโโโโโโโโโโโโโโโ  โ              โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  SQLite DB      โ  โ              โ  โ  Supabase PostgreSQL    โ  โ
โ  โ  Tablas:        โ  โ              โ  โ                         โ  โ
โ  โ  โข productos    โ  โ              โ  โ  Tabla: productos       โ  โ
โ  โ  โข carrito_itemsโ  โ              โ  โ  + Supabase Storage     โ  โ
โ  โโโโโโโโโโโโโโโโโโโ  โ              โ  โ    (imรกgenes)           โ  โ
โ                       โ              โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  ๐ฑ Almacenamiento    โ              โ  โ๏ธ  API REST + Base de datos โ
โ     interno           โ              โ      remota                   โ
โ                       โ              โ                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโ              โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Flujo Completo: Ver Productos

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PASO 1: Usuario abre MainActivity                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PASO 2: onCreate() โ viewModel.sincronizarProductos()              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PASO 3: ProductoViewModel โ repository.sincronizarProductos()      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                    โโโโโโโโโโโโโโดโโโโโโโโโโโโโ
                    โ                         โ
                    โ                         โ
        โโโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโโโโโ
        โ  RESPUESTA RรPIDA โ     โ  SINCRONIZACIรN API  โ
        โ                   โ     โ     (background)     โ
        โ  PASO 4A:         โ     โ                      โ
        โ  Repository       โ     โ  PASO 4B:            โ
        โ  devuelve Flow    โ     โ  API โ Supabase      โ
        โ  de Room          โ     โ  GET /productos      โ
        โ                   โ     โ                      โ
        โ  โ                โ     โ  โ                   โ
        โ  Datos locales    โ     โ  JSON response       โ
        โ  (instantรกneo)    โ     โ                      โ
        โโโโโโโโโโโฌโโโโโโโโโโ     โโโโโโโโโโโโฌโโโโโโโโโโโโ
                  โ                          โ
                  โ                          โ
                  โ              โโโโโโโโโโโโโโโโโโโโโโโโ
                  โ              โ  PASO 5:             โ
                  โ              โ  Guardar en Room     โ
                  โ              โ  productoDao         โ
                  โ              โ  .insertarTodos()    โ
                  โ              โโโโโโโโโโโโฌโโโโโโโโโโโโ
                  โ                         โ
                  โโโโโโโโโโโโโโฌโโโโโโโโโโโโโ
                               โ
                               โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  PASO 6: Flow<List<Producto>> emite     โ
        โ          cambios automรกticamente         โ
        โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
                           โ
                           โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  PASO 7: ViewModel observa Flow          โ
        โ          productos.collect { ... }       โ
        โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
                           โ
                           โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  PASO 8: MainActivity observa LiveData   โ
        โ          lifecycleScope.launch { ... }   โ
        โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
                           โ
                           โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  PASO 9: adapter.submitList(productos)   โ
        โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
                           โ
                           โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  PASO 10: RecyclerView renderiza         โ
        โ           Grid 2 columnas con tarjetas   โ
        โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
                           โ
                           โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  โ Usuario ve productos en pantalla     โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**โก Ventaja Offline-First:**
- Si no hay internet, Paso 4B falla pero Paso 4A funciona
- Usuario SIEMPRE ve datos (aunque sean antiguos)
- App nunca muestra pantalla en blanco

---

## ๐ Flujo Completo: Agregar al Carrito

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Usuario hace click en "Agregar al carrito"                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ProductoAdapter.onAddToCartClick(producto)                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  MainActivity โ carritoViewModel.agregarProducto(producto)           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  CarritoViewModel โ repository.agregarProducto(producto)             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  CarritoRepository:                                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โ
โ  โ  val itemExistente = carritoDao.obtenerPorId(id).first()  โ     โ
โ  โ                                                            โ     โ
โ  โ  if (itemExistente != null) {                             โ     โ
โ  โ      // Ya existe โ incrementar cantidad                  โ     โ
โ  โ      carritoDao.actualizarCantidad(id, cantidad + 1)      โ     โ
โ  โ  } else {                                                 โ     โ
โ  โ      // No existe โ crear nuevo item                      โ     โ
โ  โ      val nuevoItem = CarritoItem(...)                     โ     โ
โ  โ      carritoDao.insertar(nuevoItem)                       โ     โ
โ  โ  }                                                        โ     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Room SQLite โ tabla carrito_items (INSERT o UPDATE)                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Flow<List<CarritoItem>> emite cambios                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  CarritoViewModel observa โ totalItems se actualiza                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Badge del carrito se actualiza automรกticamente (3 items)           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Toast: "โ Keychron K8 Pro agregado al carrito"                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โ Persistido en SQLite (sobrevive al cerrar la app)              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Flujo Completo: Filtrar por Categorรญa

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Usuario hace click en chip "Teclados"                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  CategoryAdapter.setSelectedPosition(1)                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  MainActivity:                                                       โ
โ  selectedCategory = "Teclados"                                       โ
โ  filterProducts()                                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  lifecycleScope.launch {                                             โ
โ      viewModel.productos.collect { lista โ                           โ
โ          val filtrados = if (selectedCategory == "Todos") {          โ
โ              lista                                                   โ
โ          } else {                                                    โ
โ              lista.filter { it.categoria == selectedCategory }      โ
โ          }                                                           โ
โ          adapter.submitList(filtrados)                               โ
โ      }                                                               โ
โ  }                                                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  RecyclerView se actualiza (DiffUtil calcula diferencias)           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โ Usuario ve solo productos de "Teclados" (instantรกneo)           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**โก Ventaja:** Filtrado LOCAL (no requiere red), respuesta instantรกnea.

---

## ๐ธ Flujo Completo: Capturar Foto

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Usuario abre CameraActivity                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Solicitar permiso CAMERA (si no estรก otorgado)                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                    โโโโโโโโโโโโโโดโโโโโโโโโโโโโ
                    โ                         โ
                    โ                         โ
        โโโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโโโโโ
        โ  Permiso otorgado โ     โ  Permiso denegado    โ
        โโโโโโโโโโโฌโโโโโโโโโโ     โโโโโโโโโโโโฌโโโโโโโโโโโโ
                  โ                          โ
                  โ                          โ
        โโโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโโโโโ
        โ  startCamera()    โ     โ  Toast + finish()    โ
        โ  CameraX Preview  โ     โโโโโโโโโโโโโโโโโโโโโโโโ
        โโโโโโโโโโโฌโโโโโโโโโโ
                  โ
                  โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  Usuario presiona "Capturar foto" โ
        โโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ
                  โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  imageCapture.takePicture()       โ
        โ  Guardar en cacheDir:             โ
        โ  IMG_20251110_153045.jpg          โ
        โโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ
                  โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  onImageSaved(Uri)                โ
        โโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ
                  โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  setResult(RESULT_OK, uri)        โ
        โ  finish()                         โ
        โโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ
                  โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  Activity que lanzรณ la cรกmara     โ
        โ  recibe URI de la foto            โ
        โ  (para crear/editar producto)     โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Estados de Conexiรณn (Offline-First)

```
                    โโโโโโโโโโโโโโโโโโโโ
                    โ  Usuario pide    โ
                    โ  ver productos   โ
                    โโโโโโโโโโฌโโโโโโโโโโ
                             โ
                โโโโโโโโโโโโโโดโโโโโโโโโโโโโ
                โ                         โ
                โ                         โ
    โโโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโโโโโ
    โ   CON INTERNET    โ     โ   SIN INTERNET       โ
    โโโโโโโโโโโฌโโโโโโโโโโ     โโโโโโโโโโโโฌโโโโโโโโโโโโ
              โ                          โ
              โ                          โ
    โโโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโโโโโ
    โ 1. Room โ UI      โ     โ 1. Room โ UI         โ
    โ    (instantรกneo)  โ     โ    (instantรกneo)     โ
    โ                   โ     โ                      โ
    โ 2. API โ Room     โ     โ 2. API FALLA โ      โ
    โ    (background)   โ     โ    Toast error       โ
    โ                   โ     โ                      โ
    โ 3. Flow emite     โ     โ 3. Muestra datos     โ
    โ    โ UI actualiza โ     โ    antiguos de Room  โ
    โ                   โ     โ                      โ
    โ โ Datos frescos  โ     โ โ๏ธ Datos en cachรฉ    โ
    โโโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโโโโโ
```

**โ Resultado:** App SIEMPRE funcional, nunca pantalla en blanco.

---

## ๐ฏ Ventajas de esta Arquitectura

1. **Separaciรณn de responsabilidades**: Cada capa tiene un propรณsito claro
2. **Testeable**: Puedes probar cada capa independientemente
3. **Mantenible**: Cambios en una capa no rompen las demรกs
4. **Escalable**: Fรกcil agregar nuevas features
5. **Offline-first**: App funciona sin internet
6. **Reactivo**: UI se actualiza automรกticamente (Flow/LiveData)
7. **Eficiente**: Room como cachรฉ reduce llamadas a API

---

## ๐ฑ Componentes Clave

| Componente | Responsabilidad | Tecnologรญa |
|------------|----------------|------------|
| **Activities** | Mostrar UI, capturar eventos | Kotlin + XML |
| **ViewModels** | Lรณgica de presentaciรณn | ViewModel + LiveData/Flow |
| **Repository** | Coordinar fuentes de datos | Kotlin coroutines |
| **Room DAO** | Operaciones SQL locales | Room SQLite |
| **Retrofit API** | Comunicaciรณn con backend | Retrofit + OkHttp |
| **Adapters** | Renderizar listas | RecyclerView + DiffUtil |

---

**รltima actualizaciรณn**: 2025-11-12  
**Arquitectura**: MVVM con Repository Pattern (Offline-first)
